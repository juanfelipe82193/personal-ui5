{"ast":null,"code":"import RenderScheduler from \"../RenderScheduler.js\";\nimport { isDown, isUp, isLeft, isRight, isHome, isEnd } from \"../Keys.js\";\nimport EventProvider from \"../EventProvider.js\";\nimport UI5Element from \"../UI5Element.js\";\nimport NavigationMode from \"../types/NavigationMode.js\";\nimport ItemNavigationBehavior from \"../types/ItemNavigationBehavior.js\"; // navigatable items must have id and tabindex\n\nclass ItemNavigation extends EventProvider {\n  constructor(rootWebComponent, options = {}) {\n    super();\n    this.currentIndex = options.currentIndex || 0;\n    this.rowSize = options.rowSize || 1;\n    this.behavior = options.behavior || ItemNavigationBehavior.Static;\n    this.hasNextPage = true; // used in Paging mode and controlled from the rootWebComponent\n\n    this.hasPrevPage = true; // used in Paging mode and controlled from the rootWebComponent\n\n    const navigationMode = options.navigationMode;\n    const autoNavigation = !navigationMode || navigationMode === NavigationMode.Auto;\n    this.horizontalNavigationOn = autoNavigation || navigationMode === NavigationMode.Horizontal;\n    this.verticalNavigationOn = autoNavigation || navigationMode === NavigationMode.Vertical;\n    this.rootWebComponent = rootWebComponent;\n    this.rootWebComponent.addEventListener(\"keydown\", this.onkeydown.bind(this));\n\n    this.rootWebComponent._onComponentStateFinalized = () => {\n      this._init();\n    };\n  }\n\n  _init() {\n    this._getItems().forEach((item, idx) => {\n      item._tabIndex = idx === this.currentIndex ? \"0\" : \"-1\";\n    });\n  }\n\n  _horizontalNavigationOn() {\n    return this.horizontalNavigationOn;\n  }\n\n  _verticalNavigationOn() {\n    return this.verticalNavigationOn;\n  }\n\n  async _onKeyPress(event) {\n    if (this.currentIndex >= this._getItems().length) {\n      this.onOverflowBottomEdge();\n    } else if (this.currentIndex < 0) {\n      this.onOverflowTopEdge();\n    }\n\n    event.preventDefault();\n    await RenderScheduler.whenFinished();\n    this.update();\n    this.focusCurrent();\n  }\n\n  onkeydown(event) {\n    if (isUp(event) && this._verticalNavigationOn()) {\n      return this._handleUp(event);\n    }\n\n    if (isDown(event) && this._verticalNavigationOn()) {\n      return this._handleDown(event);\n    }\n\n    if (isLeft(event) && this._horizontalNavigationOn()) {\n      return this._handleLeft(event);\n    }\n\n    if (isRight(event) && this._horizontalNavigationOn()) {\n      return this._handleRight(event);\n    }\n\n    if (isHome(event)) {\n      return this._handleHome(event);\n    }\n\n    if (isEnd(event)) {\n      return this._handleEnd(event);\n    }\n  }\n\n  _handleUp(event) {\n    if (this._canNavigate()) {\n      this.currentIndex -= this.rowSize;\n\n      this._onKeyPress(event);\n    }\n  }\n\n  _handleDown(event) {\n    if (this._canNavigate()) {\n      this.currentIndex += this.rowSize;\n\n      this._onKeyPress(event);\n    }\n  }\n\n  _handleLeft(event) {\n    if (this._canNavigate()) {\n      this.currentIndex -= 1;\n\n      this._onKeyPress(event);\n    }\n  }\n\n  _handleRight(event) {\n    if (this._canNavigate()) {\n      this.currentIndex += 1;\n\n      this._onKeyPress(event);\n    }\n  }\n\n  _handleHome(event) {\n    if (this._canNavigate()) {\n      const homeEndRange = this.rowSize > 1 ? this.rowSize : this._getItems().length;\n      this.currentIndex -= this.currentIndex % homeEndRange;\n\n      this._onKeyPress(event);\n    }\n  }\n\n  _handleEnd(event) {\n    if (this._canNavigate()) {\n      const homeEndRange = this.rowSize > 1 ? this.rowSize : this._getItems().length;\n      this.currentIndex += homeEndRange - 1 - this.currentIndex % homeEndRange; // eslint-disable-line\n\n      this._onKeyPress(event);\n    }\n  }\n\n  update(current) {\n    const origItems = this._getItems();\n\n    if (current) {\n      this.currentIndex = this._getItems().indexOf(current);\n    }\n\n    if (!origItems[this.currentIndex] || origItems[this.currentIndex]._tabIndex && origItems[this.currentIndex]._tabIndex === \"0\") {\n      return;\n    }\n\n    const items = origItems.slice(0);\n\n    for (let i = 0; i < items.length; i++) {\n      items[i]._tabIndex = i === this.currentIndex ? \"0\" : \"-1\";\n    }\n\n    this.rootWebComponent._invalidate();\n  }\n\n  focusCurrent() {\n    const currentItem = this._getCurrentItem();\n\n    if (currentItem) {\n      currentItem.focus();\n    }\n  }\n\n  _canNavigate() {\n    const currentItem = this._getCurrentItem();\n\n    let activeElement = document.activeElement;\n\n    while (activeElement.shadowRoot && activeElement.shadowRoot.activeElement) {\n      activeElement = activeElement.shadowRoot.activeElement;\n    }\n\n    return currentItem && currentItem === activeElement;\n  }\n\n  _getCurrentItem() {\n    const items = this._getItems();\n\n    if (!items.length) {\n      return null;\n    } // normalize the index\n\n\n    while (this.currentIndex >= items.length) {\n      this.currentIndex -= this.rowSize;\n    }\n\n    if (this.currentIndex < 0) {\n      this.currentIndex = 0;\n    }\n\n    const currentItem = items[this.currentIndex];\n\n    if (currentItem instanceof UI5Element) {\n      return currentItem.getFocusDomRef();\n    }\n\n    if (!this.rootWebComponent.getDomRef()) {\n      return;\n    }\n\n    return this.rootWebComponent.getDomRef().querySelector(`#${currentItem.id}`);\n  }\n\n  set getItemsCallback(fn) {\n    this._getItems = fn;\n  }\n\n  set current(val) {\n    this.currentIndex = val;\n  }\n\n  onOverflowBottomEdge() {\n    const items = this._getItems();\n\n    const offset = this.currentIndex - items.length;\n\n    if (this.behavior === ItemNavigationBehavior.Cyclic) {\n      this.currentIndex = 0;\n      return;\n    }\n\n    if (this.behavior === ItemNavigationBehavior.Paging) {\n      this._handleNextPage();\n    } else {\n      this.currentIndex = items.length - 1;\n    }\n\n    this.fireEvent(ItemNavigation.BORDER_REACH, {\n      start: false,\n      end: true,\n      offset\n    });\n  }\n\n  onOverflowTopEdge() {\n    const items = this._getItems();\n\n    const offset = this.currentIndex + this.rowSize;\n\n    if (this.behavior === ItemNavigationBehavior.Cyclic) {\n      this.currentIndex = items.length - 1;\n      return;\n    }\n\n    if (this.behavior === ItemNavigationBehavior.Paging) {\n      this._handlePrevPage();\n    } else {\n      this.currentIndex = 0;\n    }\n\n    this.fireEvent(ItemNavigation.BORDER_REACH, {\n      start: true,\n      end: false,\n      offset\n    });\n  }\n\n  _handleNextPage() {\n    this.fireEvent(ItemNavigation.PAGE_BOTTOM);\n\n    const items = this._getItems();\n\n    if (!this.hasNextPage) {\n      this.currentIndex = items.length - 1;\n    } else {\n      this.currentIndex = 0;\n    }\n  }\n\n  _handlePrevPage() {\n    this.fireEvent(ItemNavigation.PAGE_TOP);\n\n    const items = this._getItems();\n\n    if (!this.hasPrevPage) {\n      this.currentIndex = 0;\n    } else {\n      this.currentIndex = (this.pageSize || items.length) - 1;\n    }\n  }\n\n}\n\nItemNavigation.PAGE_TOP = \"PageTop\";\nItemNavigation.PAGE_BOTTOM = \"PageBottom\";\nItemNavigation.BORDER_REACH = \"_borderReach\";\nexport default ItemNavigation;","map":{"version":3,"sources":["/Users/juanzorrilla/Documents/SAPUI5/personal-ui5/node_modules/@ui5/webcomponents-base/dist/delegate/ItemNavigation.js"],"names":["RenderScheduler","isDown","isUp","isLeft","isRight","isHome","isEnd","EventProvider","UI5Element","NavigationMode","ItemNavigationBehavior","ItemNavigation","constructor","rootWebComponent","options","currentIndex","rowSize","behavior","Static","hasNextPage","hasPrevPage","navigationMode","autoNavigation","Auto","horizontalNavigationOn","Horizontal","verticalNavigationOn","Vertical","addEventListener","onkeydown","bind","_onComponentStateFinalized","_init","_getItems","forEach","item","idx","_tabIndex","_horizontalNavigationOn","_verticalNavigationOn","_onKeyPress","event","length","onOverflowBottomEdge","onOverflowTopEdge","preventDefault","whenFinished","update","focusCurrent","_handleUp","_handleDown","_handleLeft","_handleRight","_handleHome","_handleEnd","_canNavigate","homeEndRange","current","origItems","indexOf","items","slice","i","_invalidate","currentItem","_getCurrentItem","focus","activeElement","document","shadowRoot","getFocusDomRef","getDomRef","querySelector","id","getItemsCallback","fn","val","offset","Cyclic","Paging","_handleNextPage","fireEvent","BORDER_REACH","start","end","_handlePrevPage","PAGE_BOTTOM","PAGE_TOP","pageSize"],"mappings":"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","sourcesContent":["import RenderScheduler from \"../RenderScheduler.js\";\nimport {\n\tisDown,\n\tisUp,\n\tisLeft,\n\tisRight,\n\tisHome,\n\tisEnd,\n} from \"../Keys.js\";\n\nimport EventProvider from \"../EventProvider.js\";\nimport UI5Element from \"../UI5Element.js\";\nimport NavigationMode from \"../types/NavigationMode.js\";\nimport ItemNavigationBehavior from \"../types/ItemNavigationBehavior.js\";\n\n// navigatable items must have id and tabindex\nclass ItemNavigation extends EventProvider {\n\tconstructor(rootWebComponent, options = {}) {\n\t\tsuper();\n\n\t\tthis.currentIndex = options.currentIndex || 0;\n\t\tthis.rowSize = options.rowSize || 1;\n\t\tthis.behavior = options.behavior || ItemNavigationBehavior.Static;\n\t\tthis.hasNextPage = true; // used in Paging mode and controlled from the rootWebComponent\n\t\tthis.hasPrevPage = true; // used in Paging mode and controlled from the rootWebComponent\n\t\tconst navigationMode = options.navigationMode;\n\t\tconst autoNavigation = !navigationMode || navigationMode === NavigationMode.Auto;\n\t\tthis.horizontalNavigationOn = autoNavigation || navigationMode === NavigationMode.Horizontal;\n\t\tthis.verticalNavigationOn = autoNavigation || navigationMode === NavigationMode.Vertical;\n\n\t\tthis.rootWebComponent = rootWebComponent;\n\t\tthis.rootWebComponent.addEventListener(\"keydown\", this.onkeydown.bind(this));\n\t\tthis.rootWebComponent._onComponentStateFinalized = () => {\n\t\t\tthis._init();\n\t\t};\n\t}\n\n\t_init() {\n\t\tthis._getItems().forEach((item, idx) => {\n\t\t\titem._tabIndex = (idx === this.currentIndex) ? \"0\" : \"-1\";\n\t\t});\n\t}\n\n\t_horizontalNavigationOn() {\n\t\treturn this.horizontalNavigationOn;\n\t}\n\n\t_verticalNavigationOn() {\n\t\treturn this.verticalNavigationOn;\n\t}\n\n\tasync _onKeyPress(event) {\n\t\tif (this.currentIndex >= this._getItems().length) {\n\t\t\tthis.onOverflowBottomEdge();\n\t\t} else if (this.currentIndex < 0) {\n\t\t\tthis.onOverflowTopEdge();\n\t\t}\n\n\t\tevent.preventDefault();\n\n\t\tawait RenderScheduler.whenFinished();\n\n\t\tthis.update();\n\t\tthis.focusCurrent();\n\t}\n\n\tonkeydown(event) {\n\t\tif (isUp(event) && this._verticalNavigationOn()) {\n\t\t\treturn this._handleUp(event);\n\t\t}\n\n\t\tif (isDown(event) && this._verticalNavigationOn()) {\n\t\t\treturn this._handleDown(event);\n\t\t}\n\n\t\tif (isLeft(event) && this._horizontalNavigationOn()) {\n\t\t\treturn this._handleLeft(event);\n\t\t}\n\n\t\tif (isRight(event) && this._horizontalNavigationOn()) {\n\t\t\treturn this._handleRight(event);\n\t\t}\n\n\t\tif (isHome(event)) {\n\t\t\treturn this._handleHome(event);\n\t\t}\n\n\t\tif (isEnd(event)) {\n\t\t\treturn this._handleEnd(event);\n\t\t}\n\t}\n\n\t_handleUp(event) {\n\t\tif (this._canNavigate()) {\n\t\t\tthis.currentIndex -= this.rowSize;\n\t\t\tthis._onKeyPress(event);\n\t\t}\n\t}\n\n\t_handleDown(event) {\n\t\tif (this._canNavigate()) {\n\t\t\tthis.currentIndex += this.rowSize;\n\t\t\tthis._onKeyPress(event);\n\t\t}\n\t}\n\n\t_handleLeft(event) {\n\t\tif (this._canNavigate()) {\n\t\t\tthis.currentIndex -= 1;\n\t\t\tthis._onKeyPress(event);\n\t\t}\n\t}\n\n\t_handleRight(event) {\n\t\tif (this._canNavigate()) {\n\t\t\tthis.currentIndex += 1;\n\t\t\tthis._onKeyPress(event);\n\t\t}\n\t}\n\n\t_handleHome(event) {\n\t\tif (this._canNavigate()) {\n\t\t\tconst homeEndRange = this.rowSize > 1 ? this.rowSize : this._getItems().length;\n\t\t\tthis.currentIndex -= this.currentIndex % homeEndRange;\n\t\t\tthis._onKeyPress(event);\n\t\t}\n\t}\n\n\t_handleEnd(event) {\n\t\tif (this._canNavigate()) {\n\t\t\tconst homeEndRange = this.rowSize > 1 ? this.rowSize : this._getItems().length;\n\t\t\tthis.currentIndex += (homeEndRange - 1 - this.currentIndex % homeEndRange); // eslint-disable-line\n\t\t\tthis._onKeyPress(event);\n\t\t}\n\t}\n\n\tupdate(current) {\n\t\tconst origItems = this._getItems();\n\n\t\tif (current) {\n\t\t\tthis.currentIndex = this._getItems().indexOf(current);\n\t\t}\n\n\t\tif (!origItems[this.currentIndex]\n\t\t\t|| (origItems[this.currentIndex]._tabIndex && origItems[this.currentIndex]._tabIndex === \"0\")) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst items = origItems.slice(0);\n\n\t\tfor (let i = 0; i < items.length; i++) {\n\t\t\titems[i]._tabIndex = (i === this.currentIndex ? \"0\" : \"-1\");\n\t\t}\n\n\n\t\tthis.rootWebComponent._invalidate();\n\t}\n\n\tfocusCurrent() {\n\t\tconst currentItem = this._getCurrentItem();\n\t\tif (currentItem) {\n\t\t\tcurrentItem.focus();\n\t\t}\n\t}\n\n\t_canNavigate() {\n\t\tconst currentItem = this._getCurrentItem();\n\n\t\tlet activeElement = document.activeElement;\n\n\t\twhile (activeElement.shadowRoot && activeElement.shadowRoot.activeElement) {\n\t\t\tactiveElement = activeElement.shadowRoot.activeElement;\n\t\t}\n\n\t\treturn currentItem && currentItem === activeElement;\n\t}\n\n\t_getCurrentItem() {\n\t\tconst items = this._getItems();\n\n\t\tif (!items.length) {\n\t\t\treturn null;\n\t\t}\n\n\t\t// normalize the index\n\t\twhile (this.currentIndex >= items.length) {\n\t\t\tthis.currentIndex -= this.rowSize;\n\t\t}\n\n\t\tif (this.currentIndex < 0) {\n\t\t\tthis.currentIndex = 0;\n\t\t}\n\n\t\tconst currentItem = items[this.currentIndex];\n\n\t\tif (currentItem instanceof UI5Element) {\n\t\t\treturn currentItem.getFocusDomRef();\n\t\t}\n\n\t\tif (!this.rootWebComponent.getDomRef()) {\n\t\t\treturn;\n\t\t}\n\n\t\treturn this.rootWebComponent.getDomRef().querySelector(`#${currentItem.id}`);\n\t}\n\n\tset getItemsCallback(fn) {\n\t\tthis._getItems = fn;\n\t}\n\n\tset current(val) {\n\t\tthis.currentIndex = val;\n\t}\n\n\tonOverflowBottomEdge() {\n\t\tconst items = this._getItems();\n\t\tconst offset = this.currentIndex - items.length;\n\n\t\tif (this.behavior === ItemNavigationBehavior.Cyclic) {\n\t\t\tthis.currentIndex = 0;\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.behavior === ItemNavigationBehavior.Paging) {\n\t\t\tthis._handleNextPage();\n\t\t} else {\n\t\t\tthis.currentIndex = items.length - 1;\n\t\t}\n\n\t\tthis.fireEvent(ItemNavigation.BORDER_REACH, { start: false, end: true, offset });\n\t}\n\n\tonOverflowTopEdge() {\n\t\tconst items = this._getItems();\n\t\tconst offset = this.currentIndex + this.rowSize;\n\n\t\tif (this.behavior === ItemNavigationBehavior.Cyclic) {\n\t\t\tthis.currentIndex = items.length - 1;\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.behavior === ItemNavigationBehavior.Paging) {\n\t\t\tthis._handlePrevPage();\n\t\t} else {\n\t\t\tthis.currentIndex = 0;\n\t\t}\n\n\t\tthis.fireEvent(ItemNavigation.BORDER_REACH, { start: true, end: false, offset });\n\t}\n\n\t_handleNextPage() {\n\t\tthis.fireEvent(ItemNavigation.PAGE_BOTTOM);\n\t\tconst items = this._getItems();\n\n\t\tif (!this.hasNextPage) {\n\t\t\tthis.currentIndex = items.length - 1;\n\t\t} else {\n\t\t\tthis.currentIndex = 0;\n\t\t}\n\t}\n\n\t_handlePrevPage() {\n\t\tthis.fireEvent(ItemNavigation.PAGE_TOP);\n\t\tconst items = this._getItems();\n\n\t\tif (!this.hasPrevPage) {\n\t\t\tthis.currentIndex = 0;\n\t\t} else {\n\t\t\tthis.currentIndex = (this.pageSize || items.length) - 1;\n\t\t}\n\t}\n}\n\nItemNavigation.PAGE_TOP = \"PageTop\";\nItemNavigation.PAGE_BOTTOM = \"PageBottom\";\nItemNavigation.BORDER_REACH = \"_borderReach\";\n\nexport default ItemNavigation;\n"]},"metadata":{},"sourceType":"module"}