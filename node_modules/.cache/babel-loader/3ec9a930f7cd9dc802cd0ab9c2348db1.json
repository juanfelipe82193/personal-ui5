{"ast":null,"code":"import { isPhone } from \"../Device.js\";\nimport EventProvider from \"../EventProvider.js\";\nimport scroll from \"../animations/scroll.js\";\nconst scrollEventName = \"scroll\";\nconst touchEndEventName = isPhone() ? \"touchend\" : \"mouseup\";\n\nclass ScrollEnablement extends EventProvider {\n  constructor(containerComponent) {\n    super();\n    this.containerComponent = containerComponent;\n    this.mouseMove = this.ontouchmove.bind(this);\n    this.mouseUp = this.ontouchend.bind(this);\n    this.touchStart = this.ontouchstart.bind(this);\n    this.isPhone = isPhone(); // On Android devices touchmove is thrown one more time than neccessary (together with touchend)\n    // so we have to cache the previus coordinates in order to provide correct parameters in the\n    // event for Android\n\n    this.cachedValue = {}; // In components like Carousel you need to know if the user has clicked on something or swiped\n    // in order to throw the needed event or not\n\n    this.startX = 0;\n    this.startY = 0;\n\n    if (this.isPhone) {\n      containerComponent.addEventListener(\"touchstart\", this.touchStart, {\n        passive: true\n      });\n      containerComponent.addEventListener(\"touchmove\", this.mouseMove, {\n        passive: true\n      });\n      containerComponent.addEventListener(\"touchend\", this.mouseUp, {\n        passive: true\n      });\n    } else {\n      containerComponent.addEventListener(\"mousedown\", this.touchStart, {\n        passive: true\n      });\n    }\n  }\n\n  set scrollContainer(container) {\n    this._container = container;\n  }\n\n  get scrollContainer() {\n    return this._container;\n  }\n\n  scrollTo(left, top) {\n    this._container.scrollLeft = left;\n    this._container.scrollTop = top;\n  }\n\n  move(dx, dy) {\n    return scroll({\n      element: this._container,\n      dx,\n      dy\n    });\n  }\n\n  getScrollLeft() {\n    return this._container.scrollLeft;\n  }\n\n  getScrollTop() {\n    return this._container.scrollTop;\n  }\n\n  _isTouchInside(touch) {\n    const rect = this._container.getBoundingClientRect();\n\n    const x = this.isPhone ? touch.clientX : touch.x;\n    const y = this.isPhone ? touch.clientY : touch.y;\n    return x >= rect.left && x <= rect.right && y >= rect.top && y <= rect.bottom;\n  }\n\n  ontouchstart(event) {\n    const touch = this.isPhone ? event.touches[0] : null;\n\n    if (!this.isPhone) {\n      document.addEventListener(\"mouseup\", this.mouseUp, {\n        passive: true\n      });\n      document.addEventListener(\"mousemove\", this.mouseMove, {\n        passive: true\n      });\n    } else {\n      // Needed only on mobile\n      this.startX = touch.pageX;\n      this.startY = touch.pageY;\n    }\n\n    this._prevDragX = this.isPhone ? touch.pageX : event.x;\n    this._prevDragY = this.isPhone ? touch.pageY : event.y;\n    this._canScroll = this._isTouchInside(this.isPhone ? touch : event);\n  }\n\n  ontouchmove(event) {\n    if (!this._canScroll) {\n      return;\n    }\n\n    const container = this._container;\n    const touch = this.isPhone ? event.touches[0] : null;\n    const dragX = this.isPhone ? touch.pageX : event.x;\n    const dragY = this.isPhone ? touch.pageY : event.y;\n    container.scrollLeft += this._prevDragX - dragX;\n    container.scrollTop += this._prevDragY - dragY;\n    this.fireEvent(scrollEventName, {\n      isLeft: dragX > this._prevDragX,\n      isRight: dragX < this._prevDragX\n    });\n    this.cachedValue.dragX = this._prevDragX;\n    this.cachedValue.dragY = this._prevDragY;\n    this._prevDragX = dragX;\n    this._prevDragY = dragY;\n  }\n\n  ontouchend(event) {\n    if (this.isPhone) {\n      const deltaX = Math.abs(event.changedTouches[0].pageX - this.startX);\n      const deltaY = Math.abs(event.changedTouches[0].pageY - this.startY);\n\n      if (deltaX < 10 && deltaY < 10) {\n        return;\n      }\n    }\n\n    if (!this._canScroll) {\n      return;\n    }\n\n    const container = this._container;\n    const dragX = this.isPhone ? event.changedTouches[0].pageX : event.x;\n    const dragY = this.isPhone ? event.changedTouches[0].pageY : event.y;\n    container.scrollLeft += this._prevDragX - dragX;\n    container.scrollTop += this._prevDragY - dragY;\n    const useCachedValues = dragX === this._prevDragX;\n\n    const _dragX = useCachedValues ? this.cachedValue.dragX : dragX; // const _dragY = useCachedValues ? this.cachedValue.dragY : dragY; add if needed\n\n\n    this.fireEvent(touchEndEventName, {\n      isLeft: _dragX < this._prevDragX,\n      isRight: _dragX > this._prevDragX\n    });\n    this._prevDragX = dragX;\n    this._prevDragY = dragY;\n\n    if (!this.isPhone) {\n      document.removeEventListener(\"mousemove\", this.mouseMove, {\n        passive: true\n      });\n      document.removeEventListener(\"mouseup\", this.mouseUp);\n    }\n  }\n\n}\n\nexport default ScrollEnablement;","map":{"version":3,"sources":["/Users/juanzorrilla/Documents/SAPUI5/personal-ui5/node_modules/@ui5/webcomponents-base/dist/delegate/ScrollEnablement.js"],"names":["isPhone","EventProvider","scroll","scrollEventName","touchEndEventName","ScrollEnablement","constructor","containerComponent","mouseMove","ontouchmove","bind","mouseUp","ontouchend","touchStart","ontouchstart","cachedValue","startX","startY","addEventListener","passive","scrollContainer","container","_container","scrollTo","left","top","scrollLeft","scrollTop","move","dx","dy","element","getScrollLeft","getScrollTop","_isTouchInside","touch","rect","getBoundingClientRect","x","clientX","y","clientY","right","bottom","event","touches","document","pageX","pageY","_prevDragX","_prevDragY","_canScroll","dragX","dragY","fireEvent","isLeft","isRight","deltaX","Math","abs","changedTouches","deltaY","useCachedValues","_dragX","removeEventListener"],"mappings":"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","sourcesContent":["import { isPhone } from \"../Device.js\";\nimport EventProvider from \"../EventProvider.js\";\nimport scroll from \"../animations/scroll.js\";\n\nconst scrollEventName = \"scroll\";\nconst touchEndEventName = isPhone() ? \"touchend\" : \"mouseup\";\n\nclass ScrollEnablement extends EventProvider {\n\tconstructor(containerComponent) {\n\t\tsuper();\n\t\tthis.containerComponent = containerComponent;\n\t\tthis.mouseMove = this.ontouchmove.bind(this);\n\t\tthis.mouseUp = this.ontouchend.bind(this);\n\t\tthis.touchStart = this.ontouchstart.bind(this);\n\n\t\tthis.isPhone = isPhone();\n\n\t\t// On Android devices touchmove is thrown one more time than neccessary (together with touchend)\n\t\t// so we have to cache the previus coordinates in order to provide correct parameters in the\n\t\t// event for Android\n\t\tthis.cachedValue = {};\n\n\t\t// In components like Carousel you need to know if the user has clicked on something or swiped\n\t\t// in order to throw the needed event or not\n\t\tthis.startX = 0;\n\t\tthis.startY = 0;\n\n\t\tif (this.isPhone) {\n\t\t\tcontainerComponent.addEventListener(\"touchstart\", this.touchStart, { passive: true });\n\t\t\tcontainerComponent.addEventListener(\"touchmove\", this.mouseMove, { passive: true });\n\t\t\tcontainerComponent.addEventListener(\"touchend\", this.mouseUp, { passive: true });\n\t\t} else {\n\t\t\tcontainerComponent.addEventListener(\"mousedown\", this.touchStart, { passive: true });\n\t\t}\n\t}\n\n\tset scrollContainer(container) {\n\t\tthis._container = container;\n\t}\n\n\tget scrollContainer() {\n\t\treturn this._container;\n\t}\n\n\tscrollTo(left, top) {\n\t\tthis._container.scrollLeft = left;\n\t\tthis._container.scrollTop = top;\n\t}\n\n\tmove(dx, dy) {\n\t\treturn scroll({\n\t\t\telement: this._container,\n\t\t\tdx,\n\t\t\tdy,\n\t\t});\n\t}\n\n\tgetScrollLeft() {\n\t\treturn this._container.scrollLeft;\n\t}\n\n\tgetScrollTop() {\n\t\treturn this._container.scrollTop;\n\t}\n\n\t_isTouchInside(touch) {\n\t\tconst rect = this._container.getBoundingClientRect();\n\t\tconst x = this.isPhone ? touch.clientX : touch.x;\n\t\tconst y = this.isPhone ? touch.clientY : touch.y;\n\n\t\treturn x >= rect.left && x <= rect.right\n\t\t\t&& y >= rect.top && y <= rect.bottom;\n\t}\n\n\tontouchstart(event) {\n\t\tconst touch = this.isPhone ? event.touches[0] : null;\n\n\t\tif (!this.isPhone) {\n\t\t\tdocument.addEventListener(\"mouseup\", this.mouseUp, { passive: true });\n\t\t\tdocument.addEventListener(\"mousemove\", this.mouseMove, { passive: true });\n\t\t} else {\n\t\t\t// Needed only on mobile\n\t\t\tthis.startX = touch.pageX;\n\t\t\tthis.startY = touch.pageY;\n\t\t}\n\n\t\tthis._prevDragX = this.isPhone ? touch.pageX : event.x;\n\t\tthis._prevDragY = this.isPhone ? touch.pageY : event.y;\n\n\t\tthis._canScroll = this._isTouchInside(this.isPhone ? touch : event);\n\t}\n\n\tontouchmove(event) {\n\t\tif (!this._canScroll) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst container = this._container;\n\t\tconst touch = this.isPhone ? event.touches[0] : null;\n\n\t\tconst dragX = this.isPhone ? touch.pageX : event.x;\n\t\tconst dragY = this.isPhone ? touch.pageY : event.y;\n\n\t\tcontainer.scrollLeft += this._prevDragX - dragX;\n\t\tcontainer.scrollTop += this._prevDragY - dragY;\n\n\t\tthis.fireEvent(scrollEventName, {\n\t\t\tisLeft: dragX > this._prevDragX,\n\t\t\tisRight: dragX < this._prevDragX,\n\t\t});\n\n\t\tthis.cachedValue.dragX = this._prevDragX;\n\t\tthis.cachedValue.dragY = this._prevDragY;\n\n\t\tthis._prevDragX = dragX;\n\t\tthis._prevDragY = dragY;\n\t}\n\n\tontouchend(event) {\n\t\tif (this.isPhone) {\n\t\t\tconst deltaX = Math.abs(event.changedTouches[0].pageX - this.startX);\n\t\t\tconst deltaY = Math.abs(event.changedTouches[0].pageY - this.startY);\n\n\t\t\tif (deltaX < 10 && deltaY < 10) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tif (!this._canScroll) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst container = this._container;\n\t\tconst dragX = this.isPhone ? event.changedTouches[0].pageX : event.x;\n\t\tconst dragY = this.isPhone ? event.changedTouches[0].pageY : event.y;\n\n\t\tcontainer.scrollLeft += this._prevDragX - dragX;\n\t\tcontainer.scrollTop += this._prevDragY - dragY;\n\n\t\tconst useCachedValues = dragX === this._prevDragX;\n\t\tconst _dragX = useCachedValues ? this.cachedValue.dragX : dragX;\n\t\t// const _dragY = useCachedValues ? this.cachedValue.dragY : dragY; add if needed\n\n\t\tthis.fireEvent(touchEndEventName, {\n\t\t\tisLeft: _dragX < this._prevDragX,\n\t\t\tisRight: _dragX > this._prevDragX,\n\t\t});\n\n\t\tthis._prevDragX = dragX;\n\t\tthis._prevDragY = dragY;\n\n\t\tif (!this.isPhone) {\n\t\t\tdocument.removeEventListener(\"mousemove\", this.mouseMove, { passive: true });\n\t\t\tdocument.removeEventListener(\"mouseup\", this.mouseUp);\n\t\t}\n\t}\n}\n\nexport default ScrollEnablement;\n"]},"metadata":{},"sourceType":"module"}