{"version":3,"file":"withChartContainer.js","sources":["../src/internal/Placeholder.tsx","../src/hooks/useSizeMonitor.ts","../src/internal/withChartContainer.tsx"],"sourcesContent":["import { Loader } from '@ui5/webcomponents-react/lib/Loader';\nimport React, { CSSProperties } from 'react';\n\nconst loaderStyles: CSSProperties = {\n  position: 'absolute'\n};\n\nexport const getLoadingState = (loading, datasets, Placeholder) => {\n  if (!loading) {\n    return null;\n  }\n\n  if (loading && datasets.length > 0) {\n    return <Loader style={loaderStyles} />;\n  }\n\n  if (loading && datasets.length === 0) {\n    return <Placeholder />;\n  }\n\n  return null;\n};\n","import { useCallback, useEffect, useRef, useState } from 'react';\nimport debounce from 'lodash.debounce';\n\nexport const useSizeMonitor = (props, container) => {\n  const { height: heightProp, width: widthProp, minHeight, minWidth } = props;\n  const [sizeState, setSizeState] = useState({\n    height: null,\n    width: null\n  });\n  const observer = useRef(null);\n\n  const dynamicHeightProp = typeof heightProp === 'string';\n  const dynamicWidthProp = typeof heightProp === 'string';\n  const enableSizeMonitor = dynamicHeightProp || dynamicWidthProp;\n\n  const recalculateSize = useCallback(\n    (e?) => {\n      let clientRectHeight;\n      let clientRectWidth;\n\n      if (!e || !e[0] || !e[0].contentRect) {\n        clientRectHeight = container.current.getBoundingClientRect().height;\n        clientRectWidth = container.current.getBoundingClientRect().width;\n      } else {\n        clientRectHeight = e[0].contentRect.height;\n        clientRectWidth = e[0].contentRect.width;\n      }\n\n      if (dynamicHeightProp || dynamicWidthProp) {\n        setSizeState((state) => ({\n          ...state,\n          ...(dynamicHeightProp && { height: Math.max(minHeight, clientRectHeight) }),\n          ...(dynamicWidthProp && { width: Math.max(minWidth, clientRectWidth) })\n        }));\n      }\n    },\n    [setSizeState, minWidth, minHeight, dynamicHeightProp, dynamicWidthProp]\n  );\n\n  useEffect(() => {\n    if (enableSizeMonitor && container.current) {\n      // @ts-ignore\n      observer.current = new ResizeObserver(debounce(recalculateSize, 500));\n      observer.current.observe(container.current);\n    }\n    return () => {\n      if (observer.current) {\n        observer.current.disconnect();\n      }\n    };\n  }, [recalculateSize]);\n\n  return {\n    height: dynamicHeightProp ? sizeState.height : heightProp,\n    width: dynamicWidthProp ? sizeState.width : widthProp\n  };\n};\n","import React, { ComponentType, CSSProperties, forwardRef, Ref, useMemo, useRef } from 'react';\nimport { createUseStyles } from 'react-jss';\nimport { ChartBaseProps } from '../interfaces/ChartBaseProps';\nimport { getLoadingState } from './Placeholder';\nimport { useSizeMonitor } from '../hooks/useSizeMonitor';\n\nconst calculateChartHeight = (props) => {\n  if (props.noLegend) {\n    return typeof props.height === 'string' ? props.height : `${props.height}px`;\n  }\n  return typeof props.height === 'string' ? `calc(${props.height} - 60px)` : `${props.height - 60}px`;\n};\n\nconst styles = {\n  chart: {\n    '& .legend': {\n      height: '55px',\n      maxHeight: '55px',\n      marginTop: '5px',\n      overflowY: 'auto',\n      display: 'flex',\n      flexWrap: 'wrap',\n      padding: '0 1rem',\n      boxSizing: 'border-box'\n    },\n    '& > svg[role=\"img\"]': {\n      width: (props) => `${props.width}px`,\n      height: calculateChartHeight\n    }\n  }\n};\n\nconst useStyles = createUseStyles(styles, { name: 'ChartContainer' });\n\nexport const withChartContainer = (Component: ComponentType<any>) => {\n  const ChartContainer = forwardRef((props: ChartBaseProps, ref: Ref<any>) => {\n    const { style, className, tooltip, loading, datasets, slot, noLegend, ...rest } = props;\n\n    const outerContainer = useRef(null);\n    const legendRef = useRef(null);\n\n    const classes = useStyles(props);\n    let classNames = classes.chart;\n    if (className) {\n      classNames = `${classNames} ${className}`;\n    }\n\n    const loadingIndicator = useMemo(() => {\n      return getLoadingState(loading, datasets, (Component as any).LoadingPlaceholder);\n    }, [loading, datasets, Component]);\n\n    const { height, width } = useSizeMonitor(props, outerContainer);\n\n    const inlineStyle: CSSProperties = useMemo(() => {\n      return {\n        position: 'relative',\n        paddingTop: '6px',\n        width: typeof props.width === 'string' ? props.width : `${width}px`,\n        height: typeof props.height === 'string' ? props.height : `${height}px`,\n        ...style\n      };\n    }, [props.width, props.height, width, height, style]);\n\n    const chartHeight = useMemo(() => (noLegend ? height : height - 60), [noLegend, height]);\n\n    const chartWrapperStyles: CSSProperties = useMemo(() => {\n      let innerChartWrapperStyles: CSSProperties = {\n        position: 'relative',\n        height: chartHeight >= 0 ? `${chartHeight}px` : 'auto',\n        width: width ? `${width}px` : 'auto'\n      };\n\n      return innerChartWrapperStyles;\n    }, [chartHeight, width]);\n\n    return (\n      <div ref={outerContainer} className={classNames} style={inlineStyle} title={tooltip} slot={slot}>\n        {loadingIndicator}\n        {height && datasets.length > 0 && (\n          <div style={chartWrapperStyles}>\n            <Component\n              {...rest}\n              noLegend={noLegend}\n              height={chartHeight}\n              width={width}\n              ref={ref}\n              datasets={datasets}\n              loading={loading}\n              legendRef={legendRef}\n            />\n          </div>\n        )}\n        <div ref={legendRef} className=\"legend\" />\n      </div>\n    );\n  });\n\n  ChartContainer.defaultProps = Component.defaultProps;\n  ChartContainer.displayName = Component.displayName;\n\n  return ChartContainer;\n};\n"],"names":["loaderStyles","position","getLoadingState","loading","datasets","Placeholder","length","useSizeMonitor","props","container","heightProp","height","widthProp","width","minHeight","minWidth","useState","sizeState","setSizeState","observer","useRef","dynamicHeightProp","dynamicWidthProp","enableSizeMonitor","recalculateSize","useCallback","e","clientRectHeight","clientRectWidth","contentRect","current","getBoundingClientRect","state","Math","max","useEffect","ResizeObserver","debounce","observe","disconnect","calculateChartHeight","noLegend","styles","chart","maxHeight","marginTop","overflowY","display","flexWrap","padding","boxSizing","useStyles","createUseStyles","name","withChartContainer","Component","ChartContainer","forwardRef","ref","style","className","tooltip","slot","rest","outerContainer","legendRef","classes","classNames","loadingIndicator","useMemo","LoadingPlaceholder","inlineStyle","paddingTop","chartHeight","chartWrapperStyles","innerChartWrapperStyles","defaultProps","displayName"],"mappings":"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"}