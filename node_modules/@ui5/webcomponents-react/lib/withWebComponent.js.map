{"version":3,"file":"withWebComponent.js","sources":["../src/internal/withWebComponent.tsx"],"sourcesContent":["import { useConsolidatedRef } from '@ui5/webcomponents-react-base/lib/useConsolidatedRef';\nimport { polyfillDeprecatedEventAPI } from '@ui5/webcomponents-react-base/lib/Utils';\nimport React, {\n  Children,\n  cloneElement,\n  forwardRef,\n  HTMLAttributes,\n  ReactElement,\n  Ref,\n  RefForwardingComponent,\n  RefObject,\n  useEffect,\n  useMemo,\n  useRef\n} from 'react';\nimport { CommonProps } from '../interfaces/CommonProps';\nimport { Ui5DomRef } from '../interfaces/Ui5DomRef';\n\nconst capitalizeFirstLetter = (s: string) => s.charAt(0).toUpperCase() + s.slice(1);\n\nconst toKebabCase = (s: string) => s.replace(/([A-Z])/g, (a, b) => `-${b.toLowerCase()}`);\n\nexport interface WithWebComponentPropTypes extends CommonProps, HTMLAttributes<HTMLElement> {\n  ref?: Ref<any>;\n  children?: any | void;\n}\n\nconst createEventWrapperFor = (eventIdentifier, eventHandler) => (event) => {\n  polyfillDeprecatedEventAPI(event);\n  return eventHandler(event);\n};\n\nexport const withWebComponent = <T extends {}>(\n  TagName: string,\n  regularProperties: string[],\n  booleanProperties: string[],\n  slotProperties: string[],\n  eventProperties: string[]\n) => {\n  const WithWebComponent = forwardRef((props: T & WithWebComponentPropTypes, wcRef: RefObject<Ui5DomRef>) => {\n    const { className, tooltip, children, ...rest } = props;\n\n    const ref = useConsolidatedRef<HTMLElement>(wcRef);\n    const eventRegistry = useRef({});\n    const eventRegistryWrapped = useRef({});\n\n    // regular props (no booleans, no slots and no events)\n    const regularProps = useMemo(\n      () => {\n        return regularProperties.reduce((acc, val) => {\n          if (rest.hasOwnProperty(val)) {\n            return { ...acc, [toKebabCase(val)]: rest[val] };\n          }\n          return acc;\n        }, {});\n      },\n      regularProperties.map((name) => rest[name])\n    );\n\n    // boolean properties - only attach if they are truthy\n    const booleanProps = useMemo(\n      () => {\n        return booleanProperties.reduce((acc, val) => {\n          if (rest[val] === true || rest[val] === 'true') {\n            return { ...acc, [toKebabCase(val)]: true };\n          }\n          return acc;\n        }, {});\n      },\n      booleanProperties.map((name) => rest[name])\n    );\n\n    const slots = useMemo(\n      () => {\n        return Object.entries(rest)\n          .filter(([slotName]) => slotProperties.includes(slotName))\n          .map(([slotName, slotValue]) => {\n            return Children.map(\n              slotValue?.type === React.Fragment ? slotValue.props.children : slotValue,\n              (item: ReactElement, index) =>\n                cloneElement(item, {\n                  key: `${slotName}-${index}`,\n                  slot: slotName\n                })\n            );\n          });\n      },\n      slotProperties.map((name) => rest[name])\n    );\n\n    // event binding\n    useEffect(\n      () => {\n        eventProperties.forEach((eventName) => {\n          const eventHandler = rest[`on${capitalizeFirstLetter(eventName)}`];\n          if (typeof eventHandler === 'function' && eventRegistry.current[eventName] !== eventHandler) {\n            if (eventRegistry.current[eventName]) {\n              ref.current.removeEventListener(eventName, eventRegistryWrapped.current[eventName]);\n            }\n            eventRegistryWrapped.current[eventName] = createEventWrapperFor(eventName, eventHandler);\n            ref.current.addEventListener(eventName, eventRegistryWrapped.current[eventName]);\n            eventRegistry.current[eventName] = eventHandler;\n          } else if (eventRegistry.current[eventName] && !eventHandler) {\n            ref.current.removeEventListener(eventName, eventRegistryWrapped.current[eventName]);\n          }\n        });\n      },\n      eventProperties.map((eventName) => rest[`on${capitalizeFirstLetter(eventName)}`])\n    );\n\n    // non web component related props, just pass them\n    const nonWebComponentRelatedProps = Object.entries(rest)\n      .filter(([key]) => !regularProperties.includes(key))\n      .filter(([key]) => !slotProperties.includes(key))\n      .filter(([key]) => !booleanProperties.includes(key))\n      .filter(([key]) => !eventProperties.map((val) => `on${capitalizeFirstLetter(val)}`).includes(key))\n      .reduce((acc, [key, val]) => ({ ...acc, [key]: val }), {});\n\n    return (\n      // @ts-ignore\n      <TagName\n        ref={ref}\n        {...booleanProps}\n        {...regularProps}\n        {...nonWebComponentRelatedProps}\n        class={className}\n        title={tooltip}\n      >\n        {slots}\n        {children}\n      </TagName>\n    );\n  });\n\n  WithWebComponent.displayName = `WithWebComponent(${TagName})`;\n\n  return (WithWebComponent as unknown) as RefForwardingComponent<Ui5DomRef, T & WithWebComponentPropTypes>;\n};\n"],"names":["capitalizeFirstLetter","s","charAt","toUpperCase","slice","toKebabCase","replace","a","b","toLowerCase","createEventWrapperFor","eventIdentifier","eventHandler","event","polyfillDeprecatedEventAPI","withWebComponent","TagName","regularProperties","booleanProperties","slotProperties","eventProperties","WithWebComponent","forwardRef","props","wcRef","className","tooltip","children","rest","ref","useConsolidatedRef","eventRegistry","useRef","eventRegistryWrapped","regularProps","useMemo","reduce","acc","val","hasOwnProperty","map","name","booleanProps","slots","Object","entries","filter","slotName","includes","slotValue","Children","type","React","Fragment","item","index","cloneElement","key","slot","useEffect","forEach","eventName","current","removeEventListener","addEventListener","nonWebComponentRelatedProps","displayName"],"mappings":"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"}