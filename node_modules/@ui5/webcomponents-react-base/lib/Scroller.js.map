{"version":3,"file":"Scroller.js","sources":["../src/Scroller/ScrollContextProvider.tsx","../src/Scroller/ScrollHelper.ts","../src/Scroller/Scroller.tsx"],"sourcesContent":["import { ScrollContext } from '@ui5/webcomponents-react-base/lib/ScrollContext';\nimport React, { FC, ReactNode, RefObject, useMemo } from 'react';\n\ninterface Props {\n  children: ReactNode;\n  scrollContainer: RefObject<any>;\n  registerElement: (id: string) => void;\n  unregisterElement: (id: string) => void;\n  scrollToElementById: (id: string) => void;\n  selectedElementId: string;\n  scrollToTop: () => void;\n}\n\nexport const ScrollContentProvider: FC<Props> = (props: Props) => {\n  const {\n    children,\n    scrollContainer,\n    registerElement,\n    unregisterElement,\n    scrollToElementById,\n    selectedElementId,\n    scrollToTop\n  } = props;\n  const context = useMemo(() => {\n    return {\n      scrollContainer,\n      registerElement,\n      unregisterElement,\n      scrollToElementById,\n      selectedElementId,\n      scrollToTop\n    };\n  }, [scrollContainer, registerElement, unregisterElement, scrollToElementById, selectedElementId, scrollToTop]);\n\n  return <ScrollContext.Provider value={context}>{children}</ScrollContext.Provider>;\n};\n","const defaultEasing = (x) => {\n  if (x < 0.5) {\n    return Math.pow(x * 2, 2) / 2;\n  }\n  return 1 - Math.pow((1 - x) * 2, 2) / 2;\n};\n\nconst cancelEvents = ['mousedown', 'mousewheel', 'touchmove', 'keydown'];\nconst subscribeCancelEvent = (cancelEvent) =>\n  typeof document !== 'undefined' && cancelEvents.forEach((event) => document.addEventListener(event, cancelEvent));\n\nconst events = {\n  registered: {},\n  scrollEvent: {\n    register: (evtName, callback) => {\n      events.registered[evtName] = callback;\n    },\n    remove: (evtName) => {\n      events.registered[evtName] = null;\n    }\n  }\n};\n\nconst functionWrapper = (value) => (typeof value === 'function' ? value : () => value);\n\nconst makeData = () => ({\n  currentPositionY: 0,\n  startPositionY: 0,\n  targetPositionY: 0,\n  progress: 0,\n  duration: 400,\n  cancel: false,\n  target: null,\n  scrollContainer: null,\n  to: null,\n  start: null,\n  deltaTop: null,\n  percent: null,\n  delayTimeout: null\n});\n\nconst animateScroll = (easing, options, timestamp) => {\n  const data = options.data;\n\n  // Cancel on specific events\n  if (!options.ignoreCancelEvents && data.cancel) {\n    // @ts-ignore\n    if (events.registered.end) {\n      // @ts-ignore\n      events.registered.end(data.to, data.target, data.currentPositionY);\n    }\n    return;\n  }\n\n  data.deltaTop = Math.round(data.targetPositionY - data.startPositionY);\n\n  if (data.start === null) {\n    data.start = timestamp;\n  }\n\n  data.progress = timestamp - data.start;\n\n  data.percent = data.progress >= data.duration ? 1 : easing(data.progress / data.duration);\n\n  data.currentPositionY = data.startPositionY + Math.ceil(data.deltaTop * data.percent);\n\n  const { scrollContainer } = options;\n  // @ts-ignore\n  if (\n    scrollContainer &&\n    scrollContainer.current &&\n    scrollContainer.current !== document &&\n    scrollContainer.current !== document.body\n  ) {\n    // @ts-ignore\n    scrollContainer.current.scrollTop = data.currentPositionY;\n  } else {\n    window.scrollTo(0, data.currentPositionY);\n  }\n\n  if (data.percent < 1) {\n    const easedAnimate = animateScroll.bind(null, easing, options);\n    requestAnimationFrame(easedAnimate);\n    return;\n  }\n\n  // @ts-ignore\n  if (events.registered.end) {\n    // @ts-ignore\n    events.registered.end(data.to, data.target, data.currentPositionY);\n  }\n};\n\nconst animateTopScroll = (y, options, to, target) => {\n  options.data = options.data || makeData();\n  const { scrollContainer } = options;\n\n  subscribeCancelEvent(() => {\n    options.data.cancel = true;\n  });\n\n  options.data.start = null;\n  options.data.cancel = false;\n  options.data.startPositionY = scrollContainer.current.scrollTop;\n  options.data.targetPositionY = options.absolute ? y : y + options.data.startPositionY;\n\n  if (options.data.startPositionY === options.data.targetPositionY) {\n    // @ts-ignore\n    if (events.registered.end) {\n      // @ts-ignore\n      events.registered.end(options.data.to, options.data.target, options.data.currentPositionY);\n    }\n    return;\n  }\n\n  options.data.deltaTop = Math.round(options.data.targetPositionY - options.data.startPositionY);\n\n  options.data.duration = functionWrapper(options.duration)(options.data.deltaTop);\n  options.data.duration = isNaN(parseFloat(options.data.duration)) ? 400 : parseFloat(options.data.duration);\n  options.data.to = to;\n  options.data.target = target;\n\n  const easedAnimate = animateScroll.bind(null, defaultEasing, options);\n\n  // @ts-ignore\n  if (events.registered.begin) {\n    // @ts-ignore\n    events.registered.begin(options.data.to, options.data.target);\n  }\n  requestAnimationFrame(easedAnimate);\n};\n\nexport const scrollTo = (toY, options, to, target) => {\n  animateTopScroll(toY, options, to, target);\n};\n","import { IScroller } from '@ui5/webcomponents-react-base/interfaces/IScroller';\nimport React, { forwardRef, RefObject, useCallback, useEffect, useImperativeHandle, useRef, useState } from 'react';\nimport { deprecationNotice } from '@ui5/webcomponents-react-base/lib/Utils';\nimport { ScrollContentProvider } from './ScrollContextProvider';\nimport { scrollTo } from './ScrollHelper';\n\nexport interface Props {\n  scrollContainer: RefObject<HTMLDivElement>;\n  children: any;\n  forceSelection?: boolean;\n}\n\ndeprecationNotice(\n  'Scroller',\n  \"'@ui5/webcomponents-react-base/lib/Scroller' is deprecated and will be removed in the next major release.\"\n);\n\nexport const Scroller = forwardRef((props: Props, ref: RefObject<IScroller>) => {\n  const { children, scrollContainer, forceSelection = true } = props;\n\n  const [selectedElementId, setSelectedElementId] = useState(null);\n\n  const elements = useRef([]);\n\n  const unregisterElement = useCallback(\n    (id) => {\n      elements.current = elements.current.filter((item) => item.id !== id);\n    },\n    [elements.current]\n  );\n\n  const onScrollContainerChanged = useCallback(() => {\n    if (!scrollContainer.current) return;\n\n    elements.current = elements.current\n      .map((element) => ({\n        ...element,\n        offsetTop: getOffset(element.htmlRef.current),\n        elementHeight: element.htmlRef.current.getBoundingClientRect().height\n      }))\n      .sort((a, b) => a.offsetTop - b.offsetTop);\n\n    if (scrollContainer.current) {\n      scroll({ target: scrollContainer.current });\n    }\n  }, [scrollContainer]);\n\n  const registerElement = useCallback(\n    (element) => {\n      unregisterElement(element.id);\n      elements.current.push(element);\n      onScrollContainerChanged();\n    },\n    [elements.current]\n  );\n\n  const scrollToElementById = useCallback(\n    (id, scrollOffset = 0) => {\n      const element = elements.current.find((item) => item.id === id);\n      if (element) {\n        const { htmlRef } = element;\n        scrollTo(\n          element.offsetTop + scrollOffset,\n          {\n            scrollContainer,\n            absolute: true\n          },\n          id,\n          htmlRef.current\n        );\n      }\n    },\n    [elements.current]\n  );\n\n  const scrollToTop = useCallback(() => {\n    scrollTo(\n      0,\n      {\n        scrollContainer,\n        absolute: true\n      },\n      null,\n      null\n    );\n  }, [scrollContainer.current]);\n\n  const getOffset = useCallback(\n    (el, offset = 0) => {\n      if (!el) return 0;\n      const nextOffset = el.offsetTop + offset;\n      if (el.parentElement === scrollContainer.current) {\n        return nextOffset;\n      }\n      return getOffset(el.offsetParent, nextOffset);\n    },\n    [scrollContainer]\n  );\n\n  const observer = useRef(new MutationObserver(onScrollContainerChanged));\n\n  const scroll = useCallback(\n    (e) => {\n      let selectedElement = elements.current.find(\n        (item) =>\n          item.spy && e.target.scrollTop >= item.offsetTop && e.target.scrollTop < item.offsetTop + item.elementHeight\n      );\n\n      if (forceSelection) {\n        if (elements.current[0] && e.target.scrollTop < elements.current[0].offsetTop) {\n          selectedElement = elements.current[0];\n        } else {\n          const lastElement = elements.current[elements.current.length - 1];\n\n          if (lastElement && e.target.scrollTop >= lastElement.offsetTop + lastElement.elementHeight) {\n            selectedElement = lastElement;\n          }\n        }\n      }\n\n      if (selectedElement && selectedElement.id !== selectedElementId) {\n        setSelectedElementId(selectedElement.id);\n      } else if (!selectedElement && selectedElementId !== null) {\n        setSelectedElementId(null);\n      }\n    },\n    [elements.current, selectedElementId, setSelectedElementId]\n  );\n\n  useImperativeHandle(\n    ref,\n    () => ({\n      scroll,\n      scrollToElementById,\n      scrollToTop\n    }),\n    [elements.current, scrollContainer, selectedElementId, setSelectedElementId]\n  );\n\n  useEffect(() => {\n    if (scrollContainer.current) {\n      observer.current.observe(scrollContainer.current, {\n        attributes: true,\n        subtree: true,\n        childList: true\n      });\n    }\n\n    return () => {\n      observer.current.disconnect();\n    };\n  }, [scrollContainer]);\n\n  return (\n    <ScrollContentProvider\n      scrollContainer={scrollContainer}\n      registerElement={registerElement}\n      unregisterElement={unregisterElement}\n      scrollToElementById={scrollToElementById}\n      selectedElementId={selectedElementId}\n      scrollToTop={scrollToTop}\n    >\n      {children}\n    </ScrollContentProvider>\n  );\n});\n\nScroller.displayName = 'Scroller';\n"],"names":["ScrollContentProvider","props","children","scrollContainer","registerElement","unregisterElement","scrollToElementById","selectedElementId","scrollToTop","context","useMemo","defaultEasing","x","Math","pow","cancelEvents","subscribeCancelEvent","cancelEvent","document","forEach","event","addEventListener","events","registered","scrollEvent","register","evtName","callback","remove","functionWrapper","value","makeData","currentPositionY","startPositionY","targetPositionY","progress","duration","cancel","target","to","start","deltaTop","percent","delayTimeout","animateScroll","easing","options","timestamp","data","ignoreCancelEvents","end","round","ceil","current","body","scrollTop","window","scrollTo","easedAnimate","bind","requestAnimationFrame","animateTopScroll","y","absolute","isNaN","parseFloat","begin","toY","deprecationNotice","Scroller","forwardRef","ref","forceSelection","useState","setSelectedElementId","elements","useRef","useCallback","id","filter","item","onScrollContainerChanged","map","element","offsetTop","getOffset","htmlRef","elementHeight","getBoundingClientRect","height","sort","a","b","scroll","push","scrollOffset","find","el","offset","nextOffset","parentElement","offsetParent","observer","MutationObserver","e","selectedElement","spy","lastElement","length","useImperativeHandle","useEffect","observe","attributes","subtree","childList","disconnect","displayName"],"mappings":"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"}